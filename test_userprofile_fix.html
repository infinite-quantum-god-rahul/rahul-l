<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UserProfile Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-btn { 
            background: #007bff; color: white; padding: 10px 20px; 
            border: none; border-radius: 5px; margin: 10px; cursor: pointer; 
        }
        .test-btn:hover { background: #0056b3; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>UserProfile Fix Test</h1>
        <p>This page helps test if the UserProfile fix is working correctly.</p>
        
        <div id="status"></div>
        
        <div style="margin: 20px 0;">
            <h3>Test Steps:</h3>
            <ol>
                <li>Click "Test UserProfile Form" below</li>
                <li>Check if the modal opens properly</li>
                <li>Verify the form is visible and not blank</li>
                <li>Check if the close button works</li>
                <li>Look for debug information in the form</li>
            </ol>
        </div>
        
        <button class="test-btn" onclick="testUserProfileForm()">Test UserProfile Form</button>
        <button class="test-btn" onclick="checkFixStatus()">Check Fix Status</button>
        <button class="test-btn" onclick="clearResults()">Clear Results</button>
        
        <div id="results" style="margin-top: 20px;"></div>
    </div>
    
    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function testUserProfileForm() {
            updateStatus('Testing UserProfile form...', 'info');
            
            // Check if the fix is loaded
            if (!window.USERPROFILE_FIX_ACTIVE) {
                updateStatus('❌ UserProfile fix not loaded! Please make sure userprofile_fix.js is included.', 'error');
                return;
            }
            
            // Check if modal system is available
            if (typeof window.openEntityModal !== 'function') {
                updateStatus('❌ Modal system not available. Please load the dashboard first.', 'error');
                return;
            }
            
            try {
                // Try to open the UserProfile modal
                window.openEntityModal('UserProfile');
                updateStatus('✅ UserProfile modal opened! Check if the form is visible and not blank.', 'success');
                
                // Wait a bit and then check the form
                setTimeout(checkFormStatus, 2000);
            } catch (error) {
                updateStatus('❌ Error opening UserProfile modal: ' + error.message, 'error');
            }
        }
        
        function checkFormStatus() {
            const modal = document.getElementById('entity-modal');
            const form = document.getElementById('entity-form');
            
            let results = '<h3>Form Status Check:</h3>';
            
            if (!modal) {
                results += '<p>❌ No modal found</p>';
            } else {
                results += '<p>✅ Modal found</p>';
                results += `<p>- Display: ${modal.style.display}</p>`;
                results += `<p>- Visibility: ${modal.style.visibility}</p>`;
                results += `<p>- Opacity: ${modal.style.opacity}</p>`;
            }
            
            if (!form) {
                results += '<p>❌ No form found</p>';
            } else {
                results += '<p>✅ Form found</p>';
                results += `<p>- Entity: ${form.getAttribute('data-entity')}</p>`;
                results += `<p>- Total fields: ${form.querySelectorAll('input, select, textarea').length}</p>`;
                results += `<p>- Visible fields: ${form.querySelectorAll('input:not([type="hidden"]), select, textarea').length}</p>`;
                results += `<p>- Hidden fields: ${form.querySelectorAll('input[type="hidden"]').length}</p>`;
                
                // Check if debug info is present
                const debugInfo = form.querySelector('div[style*="background: #e9ecef"]');
                if (debugInfo) {
                    results += '<p>✅ Debug info present</p>';
                } else {
                    results += '<p>❌ Debug info not found</p>';
                }
            }
            
            document.getElementById('results').innerHTML = results;
        }
        
        function checkFixStatus() {
            const status = {
                'Fix Active': window.USERPROFILE_FIX_ACTIVE || false,
                'Modal Router Disabled': window.DISABLE_ENTITY_MODAL_ROUTER || false,
                'openEntityModal Function': typeof window.openEntityModal,
                'editEntity Function': typeof window.editEntity,
                'closeEntityModal Function': typeof window.closeEntityModal,
                'userProfileFix Object': typeof window.userProfileFix,
                'Current URL': window.location.href
            };
            
            let results = '<h3>Fix Status:</h3>';
            Object.entries(status).forEach(([key, value]) => {
                const icon = value ? '✅' : '❌';
                results += `<p>${icon} <strong>${key}:</strong> ${value}</p>`;
            });
            
            document.getElementById('results').innerHTML = results;
        }
        
        function clearResults() {
            document.getElementById('status').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }
        
        // Auto-check on load
        window.addEventListener('load', function() {
            setTimeout(checkFixStatus, 1000);
        });
    </script>
</body>
</html>

